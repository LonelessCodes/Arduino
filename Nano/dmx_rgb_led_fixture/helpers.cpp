#include "helpers.h"

// a lerp function for float values
float lerp_f(float a, float b, float t) {
  return a + (b - a) * t;
}

// a modulo function for float values
float mod_f(float a, float m) {
  while (a >= m) {
    a -= m;
  }
  return a;
}

/*
A value mapping for gamma correction of led brightness levels

Javascript generation:
const gamma = 2.8;
const max_in = 255, max_out = 4096;

function generate() {
  let str = "const uint16_t PROGMEM gamma[] = {";
  for (let i = 0; i <= max_in; i++) {
    if (i > 0) str += ",";
    if ((i % 15) === 0) str += "\n  ";
    str += Math.floor(Math.pow(i / max_in, gamma) * max_out + 0.5).toFixed(0);
  }
  console.log(str + " };");
}
*/
const uint16_t PROGMEM gamma[256] = {
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
  1, 2, 2, 2, 3, 3, 4, 4, 5, 5, 6, 7, 8, 8, 9,
  10, 11, 12, 13, 15, 16, 17, 18, 20, 21, 23, 25, 26, 28, 30,
  32, 34, 36, 38, 40, 43, 45, 48, 50, 53, 56, 59, 62, 65, 68,
  71, 75, 78, 82, 85, 89, 93, 97, 101, 105, 110, 114, 119, 123, 128,
  133, 138, 143, 149, 154, 159, 165, 171, 177, 183, 189, 195, 202, 208, 215,
  222, 229, 236, 243, 250, 258, 266, 274, 282, 290, 298, 306, 315, 324, 332,
  341, 351, 360, 370, 379, 389, 399, 409, 419, 430, 441, 451, 462, 473, 485,
  496, 508, 520, 532, 544, 556, 569, 582, 595, 608, 621, 634, 648, 662, 676,
  690, 705, 719, 734, 749, 764, 780, 795, 811, 827, 843, 859, 876, 893, 910,
  927, 944, 962, 980, 998, 1016, 1035, 1053, 1072, 1091, 1111, 1130, 1150, 1170, 1190,
  1211, 1231, 1252, 1273, 1295, 1316, 1338, 1360, 1382, 1405, 1427, 1450, 1474, 1497, 1521,
  1545, 1569, 1593, 1618, 1643, 1668, 1693, 1719, 1745, 1771, 1797, 1824, 1851, 1878, 1905,
  1933, 1960, 1989, 2017, 2046, 2075, 2104, 2133, 2163, 2193, 2223, 2254, 2284, 2315, 2347,
  2378, 2410, 2442, 2475, 2507, 2540, 2573, 2607, 2641, 2675, 2709, 2744, 2779, 2814, 2849,
  2885, 2921, 2957, 2994, 3031, 3068, 3106, 3144, 3182, 3220, 3259, 3298, 3337, 3376, 3416,
  3457, 3497, 3538, 3579, 3620, 3662, 3704, 3746, 3789, 3832, 3875, 3919, 3962, 4007, 4051,
  4096
};
